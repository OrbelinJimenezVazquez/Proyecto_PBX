<div class="p-6 space-y-6">
  <!-- Header -->
  <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8">
    <div class="flex items-center gap-4">
      <div class="w-12 h-12 rounded-[50px] bg-[#2E86AB] flex items-center justify-center shadow-lg">
        <span class="material-icons-outlined text-white text-2xl">cable</span>
      </div>
      <div>
        <h1 class="text-3xl font-bold text-gray-800">Extensiones</h1>
        <p class="text-sm text-gray-500 mt-1">Gestión de extensiones telefónicas</p>
      </div>
    </div>
    <div class="flex items-center gap-3">
      <!-- Botón Añadir -->
      <button 
        (click)="addNewExtension()"
        [disabled]="loading"
        class="export-btn-secondary">
        <span class="material-icons-outlined text-lg">add</span>
        Añadir
      </button>
      
      <!-- Botón Eliminar Seleccionadas -->
      <button 
        (click)="deleteSelectedExtensions()" 
        [disabled]="loading || !hasSelectedExtensions"
        class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
        <span class="material-icons-outlined text-lg">delete</span>
        Eliminar
      </button>
      
      <!--  Botón Exportar Todo -->
      <button 
        (click)="exportExtensions()" 
        [disabled]="loading"
        class="export-btn-secondary">
        <span class="material-icons-outlined text-lg">download</span>
        Exportar
      </button>
      
      <!-- Botón Actualizar -->
      <button 
        (click)="loadExtensions()" 
        [disabled]="loading"
        class="btn-primary">
        <span class="material-icons-outlined text-lg">refresh</span>
        {{ loading ? 'Cargando...' : 'Actualizar' }}
      </button>
    </div>
  </div>

  <!-- Estado de Carga -->
  @if (loading) {
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
      @for (i of [1,2,3,4,5,6,7,8]; track i) {
        <div class="extension-card-skeleton">
          <div class="skeleton-avatar"></div>
          <div class="skeleton-lines">
            <div class="skeleton-line medium"></div>
            <div class="skeleton-line short"></div>
          </div>
        </div>
      }
    </div>
  } 
  <!-- Sin Resultados -->
  @else if (extensions.length === 0) {
    <div class="bg-white rounded-2xl border border-gray-200 p-12 text-center shadow-lg">
      <div class="w-20 h-20 rounded-full bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center mx-auto mb-4">
        <span class="material-icons-outlined text-gray-400 text-4xl">phonelink_erase</span>
      </div>
      <h3 class="text-xl font-semibold text-gray-800 mb-2">No se encontraron extensiones</h3>
      <p class="text-gray-500">No hay extensiones configuradas en el sistema</p>
    </div>
  } 
  
  <!-- Stats Summary -->
  @else {
    <div class="bg-white rounded-2xl border border-gray-200 p-5 shadow-lg mb-6">
      <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-blue-100 to-blue-200 flex items-center justify-center">
            <span class="material-icons-outlined text-blue-600 text-xl">phone_enabled</span>
          </div>
          <div>
            <p class="text-xs text-gray-500">Total Extensiones</p>
            <p class="text-xl font-bold text-gray-800">{{ extensions.length }}</p>
          </div>
        </div>
        
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-green-100 to-green-200 flex items-center justify-center">
            <span class="material-icons-outlined text-green-600 text-xl">check_circle</span>
          </div>
          <div>
            <p class="text-xs text-gray-500">En Línea</p>
            <p class="text-xl font-bold text-green-700">
              {{ onlineCount }}
            </p>
          </div>
        </div>
        
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center">
            <span class="material-icons-outlined text-gray-600 text-xl">cancel</span>
          </div>
          <div>
            <p class="text-xs text-gray-500">Fuera de Línea</p>
            <p class="text-xl font-bold text-gray-700">
              {{ offlineCount }}
            </p>
          </div>
        </div>
      </div>
    </div>

    <!--  TABLA CON PAGINACIÓN -->
    <div class="bg-white rounded-2xl border border-gray-200 overflow-hidden shadow-lg">
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                <!--  Checkbox de cabecera CORREGIDO -->
                <input 
                  type="checkbox" 
                  [checked]="allSelected" 
                  (change)="toggleAllSelection($event)"
                  class="form-checkbox h-4 w-4 text-[#2E86AB] rounded">
              </th>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Extensión</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nombre</th>
              <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">CW</th>
              <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">DND</th>
              <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">FM/FM</th>
              <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">CF</th>
              <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">CFB</th>
              <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">CFU</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tipo</th>
              <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Acciones</th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            @for (ext of paginatedExtensions; track ext.extension) {
              <tr class="hover:bg-gray-50 transition-colors">
                <td class="px-4 py-3 whitespace-nowrap">
                  <!--  Checkbox individual CORREGIDO -->
                  <input 
                    type="checkbox" 
                    [(ngModel)]="ext.selected"
                    (change)="updateAllSelected()"
                    class="form-checkbox h-4 w-4 text-[#2E86AB] rounded">
                </td>
                <td class="px-4 py-3 whitespace-nowrap">
                  <div class="flex items-center gap-2">
                    <div class="extension-avatar">
                      {{ (ext.name || 'U').charAt(0).toUpperCase() }}
                    </div>
                    <span class="font-bold text-gray-800">{{ ext.extension }}</span>
                  </div>
                </td>
                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-600">
                  {{ ext.name || 'Sin nombre' }}
                </td>
                <td class="px-4 py-3 whitespace-nowrap text-center">
                  <input type="checkbox" [(ngModel)]="ext.cw" class="form-checkbox h-4 w-4 text-[#2E86AB] rounded">
                </td>
                <td class="px-4 py-3 whitespace-nowrap text-center">
                  <input type="checkbox" [(ngModel)]="ext.dnd" class="form-checkbox h-4 w-4 text-[#2E86AB] rounded">
                </td>
                <td class="px-4 py-3 whitespace-nowrap text-center">
                  <input type="checkbox" [(ngModel)]="ext.fmfm" class="form-checkbox h-4 w-4 text-[#2E86AB] rounded">
                </td>
                <td class="px-4 py-3 whitespace-nowrap text-center">
                  <input type="checkbox" [(ngModel)]="ext.cf" class="form-checkbox h-4 w-4 text-[#2E86AB] rounded">
                </td>
                <td class="px-4 py-3 whitespace-nowrap text-center">
                  <input type="checkbox" [(ngModel)]="ext.cfb" class="form-checkbox h-4 w-4 text-[#2E86AB] rounded">
                </td>
                <td class="px-4 py-3 whitespace-nowrap text-center">
                  <input type="checkbox" [(ngModel)]="ext.cfu" class="form-checkbox h-4 w-4 text-[#2E86AB] rounded">
                </td>
                <td class="px-4 py-3 whitespace-nowrap">
                  <span class="px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800">
                    {{ ext.type || 'SIP' }}
                  </span>
                </td>
                <td class="px-4 py-3 whitespace-nowrap text-right">
                  <div class="flex justify-end gap-2">
                    <button class="ext-action-icon-btn w-8 h-8 p-0" title="Editar">
                      <span class="material-icons-outlined text-sm">edit</span>
                    </button>
                    <!--  Botón eliminar individual -->
                    <button 
                      class="ext-action-icon-btn w-8 h-8 p-0" 
                      title="Eliminar"
                      (click)="deleteExtension(ext)">
                      <span class="material-icons-outlined text-sm">delete</span>
                    </button>
                  </div>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>

      <!--  PAGINACIÓN DINÁMICA CON 3 BOTONES -->
      <div class="px-4 py-3 bg-gray-50 border-t border-gray-200 flex items-center justify-between text-sm text-gray-700">
        <div class="flex items-center gap-2">
          <span>Mostrando <span class="font-medium">{{ startIndex + 1 }}</span> a <span class="font-medium">{{ endIndex }}</span> de <span class="font-medium">{{ extensions.length }}</span> extensiones</span>
        </div>
        <div class="flex space-x-1">
          <button 
            class="px-3 py-1 border border-gray-300 rounded-md text-sm text-gray-700 hover:bg-gray-100 disabled:opacity-50"
            [disabled]="currentPage === 1"
            (click)="previousPage()">
            Anterior
          </button>
          @for (page of [1, 2, 3]; track page) {
            <button 
              class="px-3 py-1 rounded-md text-sm 
                    {{ currentPage === page ? 'bg-[#2E86AB] text-white' : 'border border-gray-300 text-gray-700 hover:bg-gray-100' }}"
              (click)="goToPage(page)">
              {{ page }}
            </button>
          }
          <button 
            class="px-3 py-1 border border-gray-300 rounded-md text-sm text-gray-700 hover:bg-gray-100 disabled:opacity-50"
            [disabled]="currentPage === 3"
            (click)="nextPage()">
            Siguiente
          </button>
        </div>
      </div>
    </div>

    <!-- Información adicional -->
    <div class="text-center text-sm text-gray-500 mt-6">
      <p>Mostrando {{ extensions.length }} extensiones en total</p>
    </div>
  }
</div>