<!-- src/app/queues/queues.html -->
<div class="p-6 space-y-6">
  <!-- Header -->
  <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8">
    <div class="flex items-center gap-4">
      <div class="w-12 h-12 rounded-2xl bg-[#2E86AB] flex items-center justify-center shadow-lg" 
           style="background: linear-gradient(135deg, #2E86AB 0%, #56cfe1 100%);">
        <span class="material-icons-outlined text-white text-2xl">queue</span>
      </div>
      <div>
        <h1 class="text-3xl font-bold text-gray-800">Gestión de Colas</h1>
        <p class="text-sm text-gray-500 mt-1">Administra las colas del call center</p>
      </div>
    </div>
    
    <button (click)="openCreateModal()" class="btn-primary">
      <span class="material-icons-outlined text-lg">add</span>
      Nueva Cola
    </button>
  </div>

  <!-- Barra de búsqueda -->
  <div class="bg-white rounded-xl border border-gray-200 p-4 shadow-sm">
    <div class="flex items-center gap-3">
      <span class="material-icons-outlined text-gray-400">search</span>
      <input 
        type="text"
        [(ngModel)]="searchTerm"
        (input)="filterQueues()"
        placeholder="Buscar por nombre o descripción..."
        class="flex-1 outline-none text-gray-700">
      @if (searchTerm) {
        <button (click)="searchTerm = ''; filterQueues()" class="text-gray-400 hover:text-gray-600">
          <span class="material-icons-outlined">close</span>
        </button>
      }
    </div>
  </div>

  <!-- Tabla de Colas -->
  <div class="bg-white rounded-2xl border border-gray-200 shadow-lg overflow-hidden">
    <div class="px-6 py-5 border-b border-gray-100">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-3">
          <span class="material-icons-outlined text-[#2E86AB]">list</span>
          <h2 class="text-xl font-bold text-gray-800">Colas Registradas</h2>
          <span class="text-sm text-gray-500">({{ filteredQueues.length }} colas)</span>
        </div>
      </div>
    </div>

    @if (loading) {
      <div class="p-12 text-center">
        <div class="spinner mx-auto mb-4"></div>
        <p class="text-gray-500">Cargando colas...</p>
      </div>
    } @else if (filteredQueues.length === 0) {
      <div class="p-12 text-center">
        <div class="w-20 h-20 rounded-full bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center mx-auto mb-4">
          <span class="material-icons-outlined text-gray-400 text-4xl">queue_music</span>
        </div>
        <h3 class="text-xl font-semibold text-gray-800 mb-2">
          @if (searchTerm) {
            No se encontraron colas
          } @else {
            No hay colas registradas
          }
        </h3>
        <p class="text-gray-500">
          @if (searchTerm) {
            Intenta con otro término de búsqueda
          } @else {
            Crea una nueva cola para comenzar
          }
        </p>
      </div>
    } @else {
      <div class="overflow-x-auto">
        <table class="w-full">
          <thead class="bg-gray-50 border-b border-gray-200">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cola</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Descripción</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">QName</th>
              <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Acciones</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-100">
            @for (queue of filteredQueues; track queue.id) {
              <tr class="hover:bg-gray-50 transition-colors">
                <td class="px-6 py-4 whitespace-nowrap">
                  <span class="text-sm font-mono text-gray-600">#{{ queue.id }}</span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="flex items-center gap-2">
                    <span class="material-icons-outlined text-blue-600">call_end</span>
                    <span class="font-semibold text-gray-800">{{ queue.queue }}</span>
                  </div>
                </td>
                <td class="px-6 py-4">
                  <span class="text-sm text-gray-600">{{ queue.descr || 'Sin descripción' }}</span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <span class="text-sm font-mono text-gray-500">{{ queue.qname }}</span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-right">
                  <div class="flex items-center justify-end gap-2">
                    <button 
                      (click)="openEditModal(queue)"
                      class="p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors"
                      title="Editar">
                      <span class="material-icons-outlined text-xl">edit</span>
                    </button>
                    <button 
                      (click)="deleteQueue(queue)"
                      class="p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors"
                      title="Eliminar">
                      <span class="material-icons-outlined text-xl">delete</span>
                    </button>
                  </div>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    }
  </div>
</div>

<!-- Modal de Crear/Editar -->
@if (showModal) {
  <div class="modal-overlay" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()" style="max-width: 600px;">
      <!-- Header del Modal -->
      <div class="modal-header">
        <div class="flex items-center gap-3">
          <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-100 to-blue-200 flex items-center justify-center">
            <span class="material-icons-outlined text-blue-600">queue</span>
          </div>
          <div>
            <h2 class="text-2xl font-bold text-gray-800">{{ modalTitle }}</h2>
            <p class="text-sm text-gray-500">Complete los datos de la cola</p>
          </div>
        </div>
        <button (click)="closeModal()" class="close-button">
          <span class="material-icons-outlined">close</span>
        </button>
      </div>

      <!-- Contenido del Modal -->
      <div class="modal-body">
        <form class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              Nombre de la Cola *
            </label>
            <input 
              type="text"
              [(ngModel)]="formQueue.queue"
              name="queue"
              placeholder="Ej: ventas, soporte, general"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"
              required>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              Descripción
            </label>
            <textarea 
              [(ngModel)]="formQueue.descr"
              name="descr"
              rows="3"
              placeholder="Descripción de la cola..."
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none resize-none"></textarea>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              QName ID
            </label>
            <input 
              type="number"
              [(ngModel)]="formQueue.qname"
              name="qname"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"
              required>
            <p class="text-xs text-gray-500 mt-1">ID interno de QStats</p>
          </div>
        </form>
      </div>

      <!-- Footer del Modal -->
      <div class="modal-footer">
        <button (click)="closeModal()" class="btn-secondary">
          Cancelar
        </button>
        <button (click)="saveQueue()" class="btn-primary">
          <span class="material-icons-outlined text-lg">save</span>
          {{ editingQueue ? 'Actualizar' : 'Crear' }}
        </button>
      </div>
    </div>
  </div>
}
