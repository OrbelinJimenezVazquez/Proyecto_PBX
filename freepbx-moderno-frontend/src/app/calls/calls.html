<!-- //src/app/calls/calss.html-->
<h2>游 Llamadas Detalladas</h2>

<!-- Filtros -->
<div class="filters">
  <button 
    (click)="changePeriod('today')" 
    [class.active]="currentPeriod === 'today'"
    class="filter-btn">
    Hoy ({{ currentPeriod === 'today' ? totalCalls : '' }})
  </button>
  <button 
    (click)="changePeriod('week')" 
    [class.active]="currentPeriod === 'week'"
    class="filter-btn">
    칔ltimos 7 d칤as
  </button>
  <button 
    (click)="changePeriod('month')" 
    [class.active]="currentPeriod === 'month'"
    class="filter-btn">
    칔ltimos 30 d칤as
  </button>
  <button 
    (click)="changePeriod('year')" 
    [class.active]="currentPeriod === 'year'"
    class="filter-btn">
    칔ltimo a침o
  </button>
</div>

<!-- Resumen -->
<p>
  Mostrando {{ calls.length }} de {{ totalCalls }} llamadas.
  P치gina {{ currentPage }} de {{ totalPages }}.
</p>

<!-- Tabla -->
@if (loading) {
  <p>Cargando llamadas...</p>
} @else if (calls.length === 0) {
  <p>No hay llamadas en este per칤odo.</p>
} @else {
  <div class="table-container">
    <table class="calls-table">
      <thead>
        <tr>
          <th>Fecha</th>
          <th>N칰mero</th>
          <th>Cola</th>
          <th>N칰mero de Agente</th>
          <th>Agente</th>
          <th>Evento</th>
          <th>Tiempo de espera</th>
          <th>Tiempo llamada</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        @for (call of calls; track call.uniqueid) {
          <tr>
            <td>{{ call.fecha | date:'dd/MM/yyyy HH:mm' }}</td>
            <td>{{ call.numero }}</td>
            <td>
              @if (call.cola === 'S칤') {
                <span class="tag queue">S칤</span>
              } @else {
                <span class="tag">No</span>
              }
            </td>
            <td>{{ call.numero_agente }}</td>
            <td>{{ call.agente }}</td>
            <td [class.call-status]="true" [class.answered]="call.evento === 'ANSWERED'">
              {{ call.evento === 'ANSWERED' ? 'Contestada' : 'No contestada' }}
            </td>
            <td>{{ call.tiempo_espera }} seg</td>
            <td>{{ call.tiempo_llamada }} seg</td>
            <td>
              <button (click)="viewDetails(call)" class="btn-detail">Ver m치s</button>
            </td>
          </tr>
        }
      </tbody>
    </table>
  </div>

  <!-- Paginaci칩n -->
  @if (totalPages > 1) {
    <div class="pagination">
      <button (click)="goToPage(1)" [disabled]="currentPage === 1">Primera</button>
      <button (click)="goToPage(currentPage - 1)" [disabled]="currentPage === 1">Anterior</button>
      
      <span>P치gina {{ currentPage }} de {{ totalPages }}</span>
      
      <button (click)="goToPage(currentPage + 1)" [disabled]="currentPage === totalPages">Siguiente</button>
      <button (click)="goToPage(totalPages)" [disabled]="currentPage === totalPages">칔ltima</button>
    </div>
  }
}

<!-- Bot칩n actualizar -->
<button (click)="loadCalls(currentPage)" [disabled]="loading" class="btn-refresh">
  游댃 {{ loading ? 'Cargando...' : 'Actualizar' }}
</button>