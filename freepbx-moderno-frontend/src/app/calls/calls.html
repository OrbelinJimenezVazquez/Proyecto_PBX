<!-- src/app/calls/calls.html -->
<div class="p-6">
  <h2 class="text-2xl font-bold text-gray-800 mb-4">Llamadas Detalladas</h2>

  <!-- Filtros y botón de refresh -->
  <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6 p-4">
    <div class="flex flex-wrap gap-2">
      <button 
        (click)="changePeriod('today')" 
        [class.active]="currentPeriod === 'today'"
        class="filter-btn">
        Hoy
      </button>
      <button 
        (click)="changePeriod('week')" 
        [class.active]="currentPeriod === 'week'"
        class="filter-btn">
        Últimos 7 días
      </button>
      <button 
        (click)="changePeriod('month')" 
        [class.active]="currentPeriod === 'month'"
        class="filter-btn">
        Últimos 30 días
      </button>
      <button 
        (click)="changePeriod('year')" 
        [class.active]="currentPeriod === 'year'"
        class="filter-btn">
        Último año
      </button>
    </div>
    <button 
      (click)="loadCalls(currentPage)" 
      [disabled]="loading" 
      class="btn-refresh">
      {{ loading ? 'Cargando...' : 'Recargar datos' }}
    </button>
  </div>

  <!-- Resumen -->
  <p class="text-gray-600 mb-6">
    Mostrando {{ calls.length }} de {{ totalCalls }} llamadas.
  </p>

  <!-- Tabla -->
  @if (loading) {
    <div class="text-center py-8">
      <p class="text-gray-500">Cargando llamadas...</p>
    </div>
  } @else if (calls.length === 0) {
    <div class="text-center py-8">
      <p class="text-gray-500">No hay llamadas en este período.</p>
    </div>
  } @else {
    <div class="overflow-x-auto bg-white rounded-lg shadow-sm border border-gray-100">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Fecha</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Número</th>
            <th class="px 6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cola</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Número Agente</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Agente</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Evento</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Espera</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Duración</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Acciones</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-100">
          @for (call of calls; track call.uniqueid) {
            <tr class="hover:bg-gray-50 transition-colors">
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm text-gray-600">{{ call.fecha | date:'dd/MM/yyyy'}}</div>
                <div class="text-sm font-bold text-black">{{ call.fecha | date:'shortTime' }}</div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm text-gray-900">{{ call.numero }}</div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                @if (call.cola === 'Sí') {
                  <span class="tag-queue">Sí</span>
                } @else {
                  <span class="tag-no-queue">No</span>
                }
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                {{ call.numero_agente }}
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                {{ call.agente }}
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <span [class.answered]="call.evento === 'ANSWERED'" 
                      [class.missed]="call.evento !== 'ANSWERED'">
                  {{ call.evento === 'ANSWERED' ? 'Contestada' : 'No contestada' }}
                </span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                {{ call.tiempo_espera }} seg
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                {{ call.tiempo_llamada }} seg
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm">
                <button (click)="viewDetails(call)" class="btn-detail">
                  Ver más
                </button>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>

    <!-- Paginación -->
    @if (totalPages > 1) {
      <div class="pagination">
        <button (click)="goToPage(1)" [disabled]="currentPage === 1">Primera</button>
        <button (click)="goToPage(currentPage - 1)" [disabled]="currentPage === 1">Anterior</button>
        <span class="text-sm text-gray-600">Página {{ currentPage }} de {{ totalPages }}</span>
        <button (click)="goToPage(currentPage + 1)" [disabled]="currentPage === totalPages">Siguiente</button>
        <button (click)="goToPage(totalPages)" [disabled]="currentPage === totalPages">Última</button>
      </div>
    }
  }
</div>